{% extends "base.html" %}

{% block title %}
    Careenium
{% endblock %}

{% block head %} 
    {% if development %}
        <base href="http:127.0.0.1:5000" /> 
    {% else %}
        <base href="https:real-url-will-eventually-go-here.com" /> 
    {% endif %}
{% endblock %}

{% block content %}

<script type="text/javascript">
    
    function Position (x, y) {
        this.x = x;
        this.y = y;
    };

    function Vector (pos, magnitude) {
        this.pos = pos; // use a Position object
        this.magnitude = magnitude;
    };

    function Simm (radius, mass, pos, velocity) {
        this.radius = radius;
        this.mass = mass;
        this.pos = pos;
        this.velocity = velocity;
    };

    Simm.prototype.move = function() {
        this.pos.x++;
        this.pos.y++;
    };

    function Simulation (simm_array, canvas, ctx) {
        this.simm_array = simm_array;
        this.canvas = canvas;
        this.ctx = ctx;
    };

    Simulation.prototype.advanceOne = function() {
        this.ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (var i=0; i<this.simm_array.length; i++) {
            this.simm_array[i].move(1.0);
        };
        draw_objects_on_canvas(this.ctx, this.canvas, this.simm_array);
    };

    // helper function to draw generic objects on canvas
    function draw_objects_on_canvas(context, canvas, objects) {

        for (var i=0; i<objects.length; i++) {
            context.fillStyle = "#000000";
            context.beginPath();
            context.arc(objects[i].pos.x, objects[i].pos.y, objects[i].radius, 0, 2*Math.PI);
            context.fill();
        };

    };


    $(document).ready(function() { 

        canvas = $('#game-canvas').get(0);
        ctx = canvas.getContext("2d");

        SIMMS = []; // global array to hold simm objects as they are created

        SIMM_RADIUS = 15;

        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
              x: evt.clientX - rect.left,
              y: evt.clientY - rect.top
            };
          };

        // display mouse position in HTML on mousemove
        canvas.addEventListener('mousemove', function(evt) {
            var mousePos = getMousePos(canvas, evt);
            $('#x-coord-display').text(mousePos.x)
            $('#y-coord-display').text(mousePos.y)

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#a8a8a8";
            ctx.beginPath();
            ctx.arc(mousePos.x, mousePos.y, SIMM_RADIUS, 0, 2*Math.PI);
            ctx.fill();

            draw_objects_on_canvas(ctx, canvas, SIMMS);

        }, false);

        // register mouse click
        canvas.addEventListener('click', function(evt) {
            var mousePos = getMousePos(canvas, evt);
            SIMMS.push(new Simm(SIMM_RADIUS, 1, new Position(mousePos.x, mousePos.y), 0));

            //erase canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            draw_objects_on_canvas(ctx, canvas, SIMMS);
        }, false);

        document.getElementById("btn-start-simulation").onclick = function() {
            simulation_instance = new Simulation(SIMMS, canvas, ctx);
            mainLoop(simulation_instance);
        };

        function mainLoop(simulation) {
            simulation.ctx.clearRect(0, 0, simulation.canvas.width, simulation.canvas.height);
            draw_objects_on_canvas(simulation.ctx, simulation.canvas, simulation.simm_array);
            simulation.advanceOne();
        };

    });



</script>

<div class="canvas-elem">
    <canvas id="game-canvas" width="750" height="450" style="border: 5px solid #000000;">
        Update your browser to support HTML5 Canvas
    </canvas>
</div>

<div class="cursor-display">
    <span>X: <span id="x-coord-display"> none </span></span>
    <span>Y: <span id="y-coord-display"> none </span></span>
<div>

<div class="buttons-div">
    <span><button type="button" id="btn-start-simulation" class="btn btn-info">Start Simulation</button></span>
</div>

{% endblock %}
